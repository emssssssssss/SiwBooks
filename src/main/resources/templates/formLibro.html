<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="it" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8" />
    <title th:text="${libro.id} != null ? 'Modifica Libro' : 'Aggiungi Nuovo Libro'">Gestione Libro</title>
    <link rel="stylesheet" th:href="@{/css/formLibro.css}" />
</head>
<body>

    <h1 th:text="${libro.id} != null ? 'Modifica Libro' : 'Aggiungi Nuovo Libro'">Gestione Libro</h1>

    <form th:action="${libro.id} != null ? @{/admin/libro/modifica/{id}(id=${libro.id})} : @{/admin/libro/nuovo}" 
          th:object="${libro}" 
          method="post" 
          enctype="multipart/form-data">

        <!-- Campo nascosto per l'ID (necessario per la modifica) -->
        <input type="hidden" th:if="${libro.id != null}" th:field="*{id}" />

        <div>
            <label for="titolo">Titolo:</label>
            <input type="text" id="titolo" th:field="*{titolo}" required />
            <div th:if="${#fields.hasErrors('titolo')}" th:errors="*{titolo}"></div>
        </div>

        <div>
            <label for="descrizione">Descrizione:</label>
            <textarea id="descrizione" th:field="*{descrizione}" required></textarea>
            <div th:if="${#fields.hasErrors('descrizione')}" th:errors="*{descrizione}"></div>
        </div>

        <div>
            <label for="genere">Genere:</label>
            <input type="text" id="genere" th:field="*{genere}" required />
            <div th:if="${#fields.hasErrors('genere')}" th:errors="*{genere}"></div>
        </div>

        <div>
            <label for="annoPubblicazione">Anno di Pubblicazione:</label>
            <input type="number" id="annoPubblicazione" th:field="*{annoPubblicazione}" required min="1500" max="2100" />
            <div th:if="${#fields.hasErrors('annoPubblicazione')}" th:errors="*{annoPubblicazione}"></div>
        </div>

        <div>
            <label for="immaginiFiles">Copertina / Immagini libro:</label>
            <input type="file" id="immaginiFiles" name="immaginiFiles" accept="image/*" multiple />
        </div>

        <div>
            <label for="autori">Autori:</label>
            <select id="autori" name="autori" multiple required>
                <option th:each="autore : ${autori}" 
                        th:value="${autore.id}" 
                        th:text="${autore.nome} + ' ' + ${autore.cognome}" 
                        th:selected="${libro.autori.contains(autore)}">
                </option>
            </select>
        </div>

        <div>
            <button type="submit" th:text="${libro.id} != null ? 'Aggiorna Libro' : 'Salva Libro'">Salva Libro</button>
        </div>
    </form>

</body>
</html>
